suite: StorageClass

templates:
  - storage-class.yaml

tests:
  - it: Expect storage class when enabled
    set:
      storageClasses:
        - name: test-sc
          storagePool: test-pool
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: StorageClass
      - equal:
          path: metadata.name
          value: test-sc
      - equal:
          path: parameters.storagePool
          value: test-pool

  - it: Expect no storage class when disabled
    set:
      storageClasses:
        - create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: Expect error when storage class parameter "storagePool" is not set
    set:
      storageClasses:
        - name: test-sc
    asserts:
      - failedTemplate:
          errorMessage: "invalid storage class: storage pool is not set"

  - it: Expect error when storage class name is not set
    set:
      storageClasses:
        - storagePool: test-pool
    asserts:
      - failedTemplate:
          errorMessage: "invalid storage class: name is not set"
